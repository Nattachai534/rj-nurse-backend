<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style> 
        body { font-family: 'Sarabun', sans-serif; } 
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f1f1; }
        textarea::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .loading-overlay { position: absolute; inset: 0; background: rgba(255,255,255,0.9); display: flex; justify-content: center; align-items: center; z-index: 50; backdrop-filter: blur(2px); }
        .form-section-title {
            grid-column: 1 / -1;
            font-weight: 700;
            color: #be123c;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            border-bottom: 2px solid #fecdd3;
            padding-bottom: 0.25rem;
            display: flex; align-items: center; gap: 0.5rem;
        }
        .form-section-title:first-child { margin-top: 0; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <nav class="bg-gradient-to-r from-rose-700 to-pink-600 text-white p-4 shadow-lg sticky top-0 z-40">
        <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center gap-3">
            <h1 class="text-xl font-bold flex items-center gap-2">
                üè• Admin V16.0 (Verified)
            </h1>
            <div class="flex gap-2 items-center bg-white/10 p-1.5 rounded-lg border border-white/20">
                <input type="password" id="adminSecret" placeholder="‡∏£‡∏´‡∏±‡∏™ Admin..." class="px-3 py-1.5 text-gray-800 rounded text-sm w-32 border-none shadow-inner bg-white focus:ring-2 focus:ring-rose-300">
                <button type="button" id="btnReload" onclick="fetchData()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-1.5 rounded text-sm transition font-bold shadow-md">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 sm:p-6">
        <div class="flex gap-2 mb-6 border-b-2 border-gray-200 pb-1 overflow-x-auto select-none no-scrollbar">
            <button onclick="switchTab('training_courses')" class="tab-btn px-5 py-2.5 rounded-t-lg font-semibold whitespace-nowrap transition-colors" id="tab-training">üéì ‡∏≠‡∏ö‡∏£‡∏°</button>
            <button onclick="switchTab('meeting_schedule')" class="tab-btn px-5 py-2.5 rounded-t-lg font-semibold whitespace-nowrap transition-colors" id="tab-meeting">üìù ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</button>
            <button onclick="switchTab('nursing_projects')" class="tab-btn px-5 py-2.5 rounded-t-lg font-semibold whitespace-nowrap transition-colors" id="tab-project">üöÄ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</button>
            <button onclick="switchTab('nursing_units')" class="tab-btn px-5 py-2.5 rounded-t-lg font-semibold whitespace-nowrap transition-colors" id="tab-units">üè• ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</button>
            <button onclick="switchTab('job_postings')" class="tab-btn px-5 py-2.5 rounded-t-lg font-semibold whitespace-nowrap transition-colors" id="tab-job">üíº ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô</button>
            <button onclick="switchTab('nursing_news')" class="tab-btn px-5 py-2.5 rounded-t-lg font-semibold whitespace-nowrap transition-colors" id="tab-news">üì¢ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</button>
            <button onclick="switchTab('line_users')" class="tab-btn px-5 py-2.5 rounded-t-lg font-semibold whitespace-nowrap bg-purple-100 text-purple-700" id="tab-staff">üë§ ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</button>
        </div>

        <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
            <div class="flex items-center gap-3">
                <h2 id="current-table-title" class="text-2xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                <span id="record-count" class="bg-gray-200 text-gray-600 px-3 py-1 rounded-full text-xs font-bold shadow-sm">...</span>
            </div>
            <button type="button" onclick="openAddModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg shadow-lg flex items-center gap-2 transition transform active:scale-95 w-full sm:w-auto justify-center font-medium">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> 
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>

        <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200 relative min-h-[300px]">
            <div id="loadingSpinner" class="hidden loading-overlay">
                <div class="flex flex-col items-center">
                    <div class="animate-spin w-12 h-12 border-4 border-rose-500 rounded-full border-t-transparent mb-3"></div>
                    <span class="text-rose-600 font-bold animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-600">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-100 border-b"><tr id="table-header"></tr></thead>
                    <tbody id="table-body" class="divide-y divide-gray-100">
                        <tr><td colspan="10" class="p-10 text-center text-gray-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ Admin ‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Form (Large) -->
    <div id="addModal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center z-50 backdrop-blur-sm p-4 transition-opacity">
        <div class="bg-white rounded-2xl p-6 w-full max-w-5xl shadow-2xl transform transition-all scale-100 max-h-[95vh] overflow-y-auto border border-gray-100 flex flex-col">
            <div class="flex justify-between items-center mb-5 border-b pb-3 sticky top-0 bg-white z-10">
                <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                    <span class="bg-rose-100 text-rose-600 p-1.5 rounded-lg">üìù</span> 
                    <span id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                </h3>
                <button type="button" onclick="closeAddModal()" class="text-gray-400 hover:text-red-500 text-3xl font-bold leading-none">&times;</button>
            </div>
            
            <form id="addForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pb-4" onsubmit="event.preventDefault();"></form>
            
            <div class="mt-auto border-t pt-4 flex justify-end gap-3 sticky bottom-0 bg-white z-10">
                <button type="button" onclick="closeAddModal()" class="px-5 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg font-medium transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button type="button" onclick="submitData()" id="btnSave" class="px-6 py-2.5 bg-rose-600 text-white rounded-lg hover:bg-rose-700 shadow-md font-bold transition flex items-center gap-2">
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>
    </div>

<script>
    const API_BASE_URL = "https://rj-nurse-backend.onrender.com"; 
    let currentTable = localStorage.getItem("last_tab") || "training_courses";
    let editingId = null;

    document.addEventListener("DOMContentLoaded", () => {
        const savedSecret = localStorage.getItem("admin_secret");
        if(savedSecret) { document.getElementById('adminSecret').value = savedSecret; fetchData(); }
        switchTab(currentTable, false);
    });

    const visibilityField = {name: "visibility", label: "üîí ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á", type: "select", options: ["public", "staff"]};

    // --- TABLE CONFIGURATION: ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Database V16.0 ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á ---
    const TABLE_CONFIG = {
        "training_courses": {
            title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏≠‡∏ö‡∏£‡∏°",
            headers: ["‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", "‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á"],
            fields: [
                {label: "üìå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£", type: "header"},
                {name: "course_name", label: "‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£", type: "text", col: "md:col-span-2"},
                {name: "description", label: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤", type: "textarea", col: "md:col-span-3"},
                {name: "speaker", label: "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£", type: "text"},
                {name: "cneu_points", label: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô CNEU", type: "number"},
                {name: "max_seats", label: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏±‡∏ö (‡∏Ñ‡∏ô)", type: "number"},
                visibilityField,

                {label: "üìÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£", type: "header"},
                {name: "date_announce", label: "‡∏ß‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®", type: "date"},
                {name: "date_start", label: "‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏ö‡∏£‡∏°", type: "date"},
                {name: "date_end", label: "‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏≠‡∏ö‡∏£‡∏°", type: "date"},
                {name: "date_exam_written", label: "‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô", type: "date"},
                {name: "date_exam_interview", label: "‡∏ß‡∏±‡∏ô‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå", type: "date"},
                {name: "date_report", label: "‡∏ß‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß", type: "date"},
                
                {label: "üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà & ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "header"},
                {name: "location", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô", type: "text", col: "md:col-span-2"},
                {name: "responsible_unit", label: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö", type: "text"},
                {name: "unit_phone", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "unit_floor", label: "‡∏ä‡∏±‡πâ‡∏ô/‡∏ï‡∏∂‡∏Å", type: "text"},
                {name: "contact_person", label: "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                {name: "contact_phone", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},

                {label: "üíª Zoom Meeting", type: "header"},
                {name: "link_zoom", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå Zoom", type: "text"},
                {name: "zoom_meeting_id", label: "Meeting ID", type: "text"},
                {name: "zoom_passcode", label: "Passcode", type: "text"},

                {label: "üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡πà‡∏≤‡∏á‡πÜ", type: "header"},
                {name: "link_register", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (Google Form)", type: "text"},
                {name: "link_doc_application", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö", type: "text"},
                {name: "link_poster", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå", type: "text"},
                {name: "link_announce_written", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô", type: "text"},
                {name: "link_announce_interview", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå", type: "text"},
                {name: "link_announce_final", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ú‡∏• Final", type: "text"},

                {label: "‚öôÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", type: "header"},
                {name: "process_status", label: "‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô", type: "select", col: "md:col-span-2", options: ["‡∏£‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£", "‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£", "‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£", "‡∏™‡∏≠‡∏ö‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å", "‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå", "‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£", "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"]},
                {name: "status", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î", type: "select", options: ["open", "full", "closed"]}
            ]
        },
        "meeting_schedule": {
            title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°",
            headers: ["‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", "‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á"],
            fields: [
                {label: "üìå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°", type: "header"},
                {name: "title", label: "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°", type: "text", col: "md:col-span-2"},
                {name: "agenda", label: "‡∏ß‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°", type: "textarea", col: "md:col-span-3"},
                {name: "meeting_type", label: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó", type: "select", options: ["internal", "academic", "committee"]},
                {name: "attendees_target", label: "‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°", type: "text", col: "md:col-span-2"},
                visibilityField,

                {label: "üìÖ ‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤", type: "header"},
                {name: "meeting_date", label: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", type: "date"},
                {name: "start_time", label: "‡πÄ‡∏£‡∏¥‡πà‡∏°", type: "time"},
                {name: "end_time", label: "‡πÄ‡∏•‡∏¥‡∏Å", type: "time"},
                {name: "room", label: "‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°", type: "text", col: "md:col-span-2"},

                {label: "üíª Zoom Meeting", type: "header"},
                {name: "link_zoom", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå Zoom", type: "text"},
                {name: "zoom_meeting_id", label: "Meeting ID", type: "text"},
                {name: "zoom_passcode", label: "Passcode", type: "text"},

                {label: "üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ & ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£", type: "header"},
                {name: "responsible_unit", label: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "unit_phone", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "unit_floor", label: "‡∏ä‡∏±‡πâ‡∏ô/‡∏ï‡∏∂‡∏Å", type: "text"},
                {name: "contact_person", label: "‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                {name: "contact_phone", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                {name: "link_register", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô", type: "text"},
                {name: "link_poster", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ/‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£", type: "text"},
                {name: "file_attachment", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö", type: "text"},

                {label: "‚öôÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", type: "header"},
                {name: "process_status", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", type: "select", col: "md:col-span-2", options: ["‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢", "‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô", "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å", "‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"]}
            ]
        },
        "nursing_projects": {
            title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£",
            headers: ["‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", "‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á"],
            fields: [
                {label: "üìå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", type: "header"},
                {name: "project_name", label: "‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", type: "text", col: "md:col-span-2"},
                {name: "objective", label: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå", type: "textarea", col: "md:col-span-3"},
                {name: "fiscal_year", label: "‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", type: "number", value: 2568},
                {name: "budget", label: "‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (‡∏ö‡∏≤‡∏ó)", type: "number"},
                visibilityField,

                {label: "üìÖ ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤", type: "header"},
                {name: "date_announce", label: "‡∏ß‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®", type: "date"},
                {name: "start_date", label: "‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°", type: "date"},
                {name: "end_date", label: "‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î", type: "date"},

                {label: "üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà & Zoom", type: "header"},
                {name: "location", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î", type: "text", col: "md:col-span-2"},
                {name: "link_zoom", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå Zoom", type: "text"},
                {name: "zoom_meeting_id", label: "Meeting ID", type: "text"},
                {name: "zoom_passcode", label: "Passcode", type: "text"},

                {label: "üìû ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö", type: "header"},
                {name: "responsible_unit", label: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "unit_phone", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "unit_floor", label: "‡∏ä‡∏±‡πâ‡∏ô/‡∏ï‡∏∂‡∏Å", type: "text"},
                {name: "contact_person", label: "‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                {name: "contact_phone", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠", type: "text"},

                {label: "üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ", type: "header"},
                {name: "link_register", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡∏™‡∏°‡∏±‡∏Ñ‡∏£", type: "text"},
                {name: "link_poster", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå", type: "text"},

                {label: "‚öôÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", type: "header"},
                {name: "process_status", label: "‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô", type: "select", options: ["‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô", "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô", "‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•", "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô", "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"]},
                {name: "status", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î", type: "select", options: ["planned", "ongoing", "completed", "cancelled"]}
            ]
        },
        "nursing_units": {
            title: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô",
            headers: ["‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£", "‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á"],
            fields: [
                {label: "üìå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", type: "header"},
                {name: "unit_name", label: "‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/Ward", type: "text", col: "md:col-span-2"},
                {name: "floor", label: "‡∏ä‡∏±‡πâ‡∏ô/‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£", type: "text"},
                {name: "phone_number", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå", type: "text"},
                {name: "description", label: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°", type: "textarea", col: "md:col-span-3"},
                {name: "link_poster", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà", type: "text"},
                visibilityField
            ]
        },
        "job_postings": {
            title: "‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô",
            headers: ["‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á", "‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", "‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á"],
            fields: [
                {label: "üìå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á", type: "header"},
                {name: "position_name", label: "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö", type: "text", col: "md:col-span-2"},
                {name: "quantity", label: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏±‡∏ö (‡∏≠‡∏±‡∏ï‡∏£‡∏≤)", type: "number"},
                {name: "description", label: "‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥/‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î", type: "textarea", col: "md:col-span-3"},
                visibilityField,

                {label: "üìÖ ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤", type: "header"},
                {name: "date_open", label: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö", type: "date"},
                {name: "date_close", label: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö", type: "date"},

                {label: "üìç ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "header"},
                {name: "location_apply", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£", type: "text", col: "md:col-span-2"},
                {name: "contact_info", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°", type: "text"},
                {name: "link_apply", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå", type: "text"},
                {name: "link_poster", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®", type: "text"},
                {name: "link_website", label: "‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®", type: "text"},

                {label: "‚öôÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", type: "header"},
                {name: "status", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö", type: "select", options: ["open", "closed"]},
                {name: "process_status", label: "‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô", type: "select", options: ["‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£", "‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≠‡∏ö", "‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô/‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥", "‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå", "‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ú‡∏•", "‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£"]}
            ]
        },
        "nursing_news": {
            title: "‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå",
            headers: ["‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á"],
            fields: [
                {label: "üìå ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß", type: "header"},
                {name: "topic", label: "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß", type: "text", col: "md:col-span-2"},
                {name: "detail", label: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤", type: "textarea", col: "md:col-span-3"},
                visibilityField,

                {label: "üìÖ ‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤", type: "header"},
                {name: "news_date", label: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", type: "date"},
                {name: "news_time", label: "‡πÄ‡∏ß‡∏•‡∏≤", type: "time"},

                {label: "üìç ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤ & Zoom", type: "header"},
                {name: "source_unit", label: "‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "location", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)", type: "text"},
                {name: "contact_info", label: "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°", type: "text"},
                {name: "link_zoom", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå Zoom (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)", type: "text"},
                {name: "zoom_meeting_id", label: "Meeting ID", type: "text"},
                {name: "zoom_passcode", label: "Passcode", type: "text"},

                {label: "üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ", type: "header"},
                {name: "link_website", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠", type: "text"},
                {name: "link_document", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (PDF)", type: "text"},
                {name: "link_poster", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏Ç‡πà‡∏≤‡∏ß", type: "text"},
                
                {name: "status", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", type: "select", options: ["active", "archived"]}
            ]
        },
        "line_users": {
            title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô LINE",
            headers: ["Line ID", "‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå"],
            fields: [
                {name: "line_user_id", label: "Line User ID", type: "text", col: "md:col-span-2"},
                {name: "first_name", label: "‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á", type: "text"},
                {name: "last_name", label: "‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", type: "text"},
                {name: "department", label: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "role", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå", type: "select", options: ["guest", "staff", "admin"]}
            ]
        }
    };

    // ... (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô switchTab, fetchData, renderRow, openAddModal, submitData, deleteData ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ...
    function switchTab(table, loadData = true) {
        currentTable = table;
        localStorage.setItem("last_tab", table);
        document.querySelectorAll('.tab-btn').forEach(b => {
            b.classList.remove('bg-rose-500', 'text-white', 'shadow-md');
            b.classList.add('bg-white', 'text-gray-600', 'hover:bg-gray-50');
        });
        
        // Map Tab ID
        let btnId = 'tab-training';
        if(table === 'meeting_schedule') btnId = 'tab-meeting';
        else if(table === 'nursing_projects') btnId = 'tab-project';
        else if(table === 'nursing_units') btnId = 'tab-units';
        else if(table === 'job_postings') btnId = 'tab-job';
        else if(table === 'nursing_news') btnId = 'tab-news';
        else if(table === 'line_users') btnId = 'tab-staff';

        const active = document.getElementById(btnId);
        if(active) {
            active.classList.remove('bg-white', 'text-gray-600', 'hover:bg-gray-50');
            active.classList.add('bg-rose-500', 'text-white', 'shadow-md');
        }
        document.getElementById('current-table-title').innerText = TABLE_CONFIG[table].title;
        renderTableHeader();
        if(loadData) fetchData();
    }

    function renderTableHeader() {
        const thead = document.getElementById('table-header');
        thead.innerHTML = TABLE_CONFIG[currentTable].headers.map(h => `<th class="px-6 py-3 whitespace-nowrap border-b font-bold tracking-wider text-gray-700">${h}</th>`).join('') + `<th class="px-6 py-3 border-b text-center text-gray-700 font-bold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>`;
    }

    async function fetchData() {
        const secret = document.getElementById('adminSecret').value;
        if(!secret) return;
        localStorage.setItem("admin_secret", secret);
        document.getElementById('loadingSpinner').classList.remove('hidden');
        document.getElementById('btnReload').disabled = true;

        try {
            const res = await axios.get(`${API_BASE_URL}/api/admin/${currentTable}?t=${new Date().getTime()}`, { headers: { 'secret': secret } });
            const tbody = document.getElementById('table-body');
            document.getElementById('record-count').innerText = `${res.data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            tbody.innerHTML = res.data.length === 0 ? `<tr><td colspan="10" class="p-10 text-center text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>` : res.data.map(row => renderRow(row)).join('');
        } catch (e) { Swal.fire('Error', e.message, 'error'); } 
        finally { document.getElementById('loadingSpinner').classList.add('hidden'); document.getElementById('btnReload').disabled = false; }
    }

    function renderRow(row) {
        let cols = '';
        const rowData = JSON.stringify(row).replace(/"/g, '&quot;');
        let visBadge = "";
        if (row.visibility) visBadge = row.visibility === 'staff' ? '<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs border border-red-200">üîí Staff</span>' : '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs border border-green-200">üåç Public</span>';

        if(currentTable === 'line_users') {
            cols = `<td class="px-6 py-4 text-xs font-mono text-gray-500">${row.line_user_id.substring(0, 8)}...</td><td class="px-6 py-4 font-bold text-gray-800">${row.first_name||'-'} ${row.last_name||''}</td><td class="px-6 py-4">${row.role}</td>`;
        } else {
            let name = row.course_name || row.title || row.project_name || row.unit_name || row.position_name || row.topic;
            let sub = row.date_start || row.meeting_date || row.responsible_unit || row.phone_number || row.date_close || row.news_date;
            let status = row.process_status || row.status || '';
            cols = `<td class="px-6 py-4 font-semibold">${name}</td><td>${sub}</td><td><span class="bg-gray-100 px-2 py-1 rounded text-xs">${status}</span></td><td>${visBadge}</td>`;
        }
        return `<tr class="bg-white border-b hover:bg-rose-50">${cols}<td class="px-6 py-4 text-center"><button onclick='openEditModal(${rowData})' class="text-blue-500 mr-2">‚úèÔ∏è</button><button onclick="deleteData('${row.id||row.line_user_id}')" class="text-red-500">üóëÔ∏è</button></td></tr>`;
    }

    function openAddModal() { editingId = null; document.getElementById('modalTitle').innerText = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà"; renderForm(); document.getElementById('addModal').classList.remove('hidden'); }
    function openEditModal(row) { editingId = row.id || row.line_user_id; document.getElementById('modalTitle').innerText = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"; renderForm(row); document.getElementById('addModal').classList.remove('hidden'); }
    function closeAddModal() { document.getElementById('addModal').classList.add('hidden'); }
    
    function renderForm(data = {}) {
        const form = document.getElementById('addForm');
        form.innerHTML = TABLE_CONFIG[currentTable].fields.map(f => {
            if(f.type === 'header') return `<div class="form-section-title">${f.label}</div>`;
            let val = data[f.name] || '';
            let input = '';
            if(f.type === 'select') input = `<select name="${f.name}" class="w-full p-2.5 border rounded">${f.options.map(o => `<option value="${o}" ${val===o?'selected':''}>${o}</option>`).join('')}</select>`;
            else if(f.type === 'textarea') input = `<textarea name="${f.name}" class="w-full p-2.5 border rounded h-24">${val}</textarea>`;
            else { if(f.type==='date' && val) val = val.split('T')[0]; input = `<input type="${f.type}" name="${f.name}" value="${val}" class="w-full p-2.5 border rounded">`; }
            return `<div class="${f.col||'col-span-1'}"><label class="text-xs font-bold text-gray-500">${f.label}</label>${input}</div>`;
        }).join('');
    }

    async function submitData() {
        const data = Object.fromEntries(new FormData(document.getElementById('addForm')).entries());
        try {
            const url = editingId ? `${API_BASE_URL}/api/admin/${currentTable}/${editingId}` : `${API_BASE_URL}/api/admin/${currentTable}`;
            const method = editingId ? 'put' : 'post';
            await axios[method](url, data, { headers: { 'secret': document.getElementById('adminSecret').value } });
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', 'success'); closeAddModal(); fetchData();
        } catch (e) { Swal.fire('Error', e.message, 'error'); }
    }

    async function deleteData(id) {
        if((await Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?', icon: 'warning', showCancelButton: true })).isConfirmed) {
            await axios.delete(`${API_BASE_URL}/api/admin/${currentTable}/${id}`, { headers: { 'secret': document.getElementById('adminSecret').value } });
            fetchData();
        }
    }
</script>
</body>
</html>
