<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <style> 
        body { font-family: 'Sarabun', sans-serif; } 
        /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Scrollbar ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Textarea */
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f1f1; }
        textarea::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <nav class="bg-rose-600 text-white p-4 shadow-lg sticky top-0 z-40">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2">üè• Admin Panel V3.5</h1>
            <div class="flex gap-2 items-center">
                <input type="password" id="adminSecret" placeholder="‡∏£‡∏´‡∏±‡∏™ Admin..." class="px-3 py-1 text-gray-800 rounded text-sm w-32 border-none focus:ring-2 focus:ring-rose-300 shadow-inner">
                <button onclick="fetchData()" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded text-sm transition font-medium">‡πÇ‡∏´‡∏•‡∏î</button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-6">
        <!-- Tabs -->
        <div class="flex gap-2 mb-6 border-b border-gray-300 pb-1 overflow-x-auto">
            <button onclick="switchTab('training_courses')" class="tab-btn px-6 py-2 rounded-t-lg bg-rose-500 text-white" id="tab-training">‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</button>
            <button onclick="switchTab('meeting_schedule')" class="tab-btn px-6 py-2 rounded-t-lg bg-gray-200 text-gray-600" id="tab-meeting">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</button>
            <button onclick="switchTab('nursing_projects')" class="tab-btn px-6 py-2 rounded-t-lg bg-gray-200 text-gray-600" id="tab-project">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</button>
            <button onclick="switchTab('nursing_units')" class="tab-btn px-6 py-2 rounded-t-lg bg-gray-200 text-gray-600" id="tab-units">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</button>
        </div>

        <div class="flex justify-between items-center mb-4">
            <h2 id="current-table-title" class="text-2xl font-bold text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
            <button onclick="openAddModal()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg shadow flex items-center gap-2 transition transform active:scale-95">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>

        <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200">
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-600">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 border-b">
                        <tr id="table-header"></tr>
                    </thead>
                    <tbody id="table-body">
                        <tr><td colspan="6" class="p-8 text-center text-gray-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ Admin...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Form -->
    <div id="addModal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50 backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl p-6 w-full max-w-2xl shadow-2xl transform transition-all scale-100 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-lg font-bold text-gray-800">üìù ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <button onclick="closeAddModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            <form id="addForm" class="grid grid-cols-1 md:grid-cols-2 gap-4"></form>
            <div class="mt-6 flex justify-end gap-2 border-t pt-4">
                <button onclick="closeAddModal()" class="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="submitAddData()" class="px-6 py-2 bg-rose-600 text-white rounded-lg hover:bg-rose-700 shadow-md font-medium">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>
    </div>

<script>
    // ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç URL ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Render ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const API_BASE_URL = "https://rj-nurse-backend.onrender.com"; 
    let currentTable = "training_courses";

    document.addEventListener("DOMContentLoaded", () => {
        const savedSecret = localStorage.getItem("admin_secret");
        if(savedSecret) { document.getElementById('adminSecret').value = savedSecret; fetchData(); }
    });

    const TABLE_CONFIG = {
        "training_courses": {
            title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏≠‡∏ö‡∏£‡∏°",
            headers: ["‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î", "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", "‡∏•‡∏¥‡∏á‡∏Å‡πå", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"],
            fields: [
                {name: "course_name", label: "‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£", type: "text", col: "span-2"},
                // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (Textarea)
                {name: "description", label: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î/‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£", type: "textarea", col: "span-2"},
                
                {name: "date_start", label: "‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏ö‡∏£‡∏°", type: "date"},
                {name: "date_end", label: "‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î", type: "date"},
                {name: "location", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î", type: "text", col: "span-2"},
                
                {name: "link_register", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (Google Form)", type: "text"},
                {name: "link_zoom", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå Zoom/Online", type: "text"},
                
                {name: "responsible_unit", label: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö", type: "text"},
                {name: "unit_phone", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "unit_floor", label: "‡∏ä‡∏±‡πâ‡∏ô/‡∏ï‡∏∂‡∏Å", type: "text"},
                {name: "contact_person", label: "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                {name: "contact_phone", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                
                {name: "process_status", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô", type: "select", 
                 options: ["‡∏£‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£", "‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£", "‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£", "‡∏™‡∏≠‡∏ö‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å", "‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå", "‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£", "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"]}
            ]
        },
        "meeting_schedule": {
            title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°",
            headers: ["‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤", "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", "‡∏•‡∏¥‡∏á‡∏Å‡πå", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"],
            fields: [
                {name: "title", label: "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°", type: "text", col: "span-2"},
                // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° (Textarea)
                {name: "agenda", label: "‡∏ß‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°/‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î", type: "textarea", col: "span-2"},
                
                {name: "meeting_date", label: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", type: "date"},
                {name: "room", label: "‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°", type: "text"},
                {name: "start_time", label: "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°", type: "time"},
                {name: "end_time", label: "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡∏¥‡∏Å", type: "time"},
                
                {name: "link_register", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô", type: "text"},
                {name: "link_zoom", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå Zoom", type: "text"},
                
                {name: "responsible_unit", label: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "contact_person", label: "‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                {name: "process_status", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", type: "select", options: ["‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢", "‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô", "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"]}
            ]
        },
        "nursing_projects": {
            title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£",
            headers: ["‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", "‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", "‡∏•‡∏¥‡∏á‡∏Å‡πå", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"],
            fields: [
                {name: "project_name", label: "‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", type: "text", col: "span-2"},
                // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå (Textarea)
                {name: "objective", label: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå/‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", type: "textarea", col: "span-2"},
                
                {name: "fiscal_year", label: "‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", type: "number", value: 2568},
                {name: "responsible_unit", label: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "contact_person", label: "‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                
                {name: "link_register", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡∏™‡∏°‡∏±‡∏Ñ‡∏£", type: "text"},
                {name: "link_zoom", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå Zoom", type: "text"},
                
                {name: "process_status", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", type: "select", options: ["‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô", "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"]}
            ]
        },
        "nursing_units": {
            title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/Wards",
            headers: ["‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", "‡∏ä‡∏±‡πâ‡∏ô/‡∏ï‡∏∂‡∏Å", "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£", "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"],
            fields: [
                {name: "unit_name", label: "‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/Ward", type: "text", col: "span-2"},
                {name: "floor", label: "‡∏ä‡∏±‡πâ‡∏ô/‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£", type: "text"},
                {name: "phone_number", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå", type: "text"},
                {name: "description", label: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°", type: "textarea", col: "span-2"}
            ]
        }
    };

    function switchTab(table) {
        currentTable = table;
        document.querySelectorAll('.tab-btn').forEach(b => {
            b.classList.remove('bg-rose-500', 'text-white');
            b.classList.add('bg-gray-200', 'text-gray-600');
        });
        
        let btnId = 'tab-training';
        if(table === 'meeting_schedule') btnId = 'tab-meeting';
        else if(table === 'nursing_projects') btnId = 'tab-project';
        else if(table === 'nursing_units') btnId = 'tab-units';

        document.getElementById(btnId).classList.remove('bg-gray-200', 'text-gray-600');
        document.getElementById(btnId).classList.add('bg-rose-500', 'text-white');
        
        document.getElementById('current-table-title').innerText = TABLE_CONFIG[table].title;
        renderTableHeader();
        fetchData();
    }

    function renderTableHeader() {
        const thead = document.getElementById('table-header');
        thead.innerHTML = TABLE_CONFIG[currentTable].headers.map(h => `<th class="px-6 py-3 whitespace-nowrap">${h}</th>`).join('') + `<th class="px-6 py-3">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>`;
    }

    async function fetchData() {
        const secret = document.getElementById('adminSecret').value;
        localStorage.setItem("admin_secret", secret);
        
        try {
            const res = await axios.get(`${API_BASE_URL}/api/admin/${currentTable}`, { headers: { 'secret': secret } });
            if(res.data.error) throw new Error(res.data.error);
            
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = res.data.map(row => {
                let cols = '';
                
                if(currentTable === 'nursing_units') {
                    cols = `<td class="px-6 py-4 font-semibold">${row.unit_name}</td>
                            <td class="px-6 py-4">${row.floor||'-'}</td>
                            <td class="px-6 py-4 text-blue-600">${row.phone_number||'-'}</td>
                            <td class="px-6 py-4 text-gray-500 text-sm max-w-xs truncate">${row.description||''}</td>`;
                } else {
                    let contact = `${row.responsible_unit||'-'} <br/><span class="text-xs text-gray-500">${row.unit_phone||''}</span>`;
                    if(row.contact_person) contact += `<br/><span class="text-xs text-blue-500">‡∏Ñ‡∏∏‡∏ì${row.contact_person}</span>`;

                    let linksHtml = '';
                    if (row.link_register) linksHtml += `<a href="${row.link_register}" target="_blank" class="text-white bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-[10px] mr-1 inline-block mb-1">üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a>`;
                    if (row.link_zoom) linksHtml += `<a href="${row.link_zoom}" target="_blank" class="text-white bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-[10px] inline-block">üìπ Zoom</a>`;

                    if(currentTable === 'training_courses') {
                        cols = `<td class="px-6 py-4 font-semibold">${row.course_name}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-xs">${row.date_start}</td>
                                <td class="px-6 py-4 text-sm">${contact}</td>
                                <td class="px-6 py-4">${linksHtml}</td>
                                <td class="px-6 py-4"><span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs whitespace-nowrap">${row.process_status}</span></td>`;
                    } else if(currentTable === 'meeting_schedule') {
                        cols = `<td class="px-6 py-4 font-semibold">${row.title}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-xs">${row.meeting_date}<br>${row.start_time}</td>
                                <td class="px-6 py-4 text-sm">${contact}</td>
                                <td class="px-6 py-4">${linksHtml}</td>
                                <td class="px-6 py-4"><span class="bg-gray-100 px-2 py-1 rounded text-xs whitespace-nowrap">${row.process_status}</span></td>`;
                    } else if(currentTable === 'nursing_projects') {
                        cols = `<td class="px-6 py-4 font-semibold">${row.project_name}</td>
                                <td class="px-6 py-4 text-sm">${row.responsible_unit}</td>
                                <td class="px-6 py-4 text-sm">‡∏Ñ‡∏∏‡∏ì${row.contact_person||'-'}</td>
                                <td class="px-6 py-4">${linksHtml}</td>
                                <td class="px-6 py-4"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs whitespace-nowrap">${row.process_status}</span></td>`;
                    }
                }
                return `<tr class="bg-white border-b hover:bg-gray-50">${cols}<td class="px-6 py-4 text-center"><button onclick="deleteData(${row.id})" class="text-red-500 hover:bg-red-100 p-2 rounded transition" title="‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">üóëÔ∏è</button></td></tr>`;
            }).join('');
        } catch (e) {
            Swal.fire('Error', e.message, 'error');
        }
    }

    function openAddModal() {
        const form = document.getElementById('addForm');
        form.innerHTML = TABLE_CONFIG[currentTable].fields.map(f => {
            let input = '';
            let colClass = f.col ? f.col : 'span-1';
            
            if(f.type === 'select') {
                input = `<select name="${f.name}" class="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-200 outline-none bg-white transition">${f.options.map(o => `<option value="${o}">${o}</option>`).join('')}</select>`;
            } else if (f.type === 'textarea') {
                input = `<textarea name="${f.name}" placeholder="${f.label}" class="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-200 outline-none h-24 resize-none transition"></textarea>`;
            } else {
                input = `<input type="${f.type}" name="${f.name}" placeholder="${f.label}" value="${f.value||''}" class="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-200 outline-none transition">`;
            }
            return `<div class="col-${colClass} ${f.type === 'textarea' ? 'md:col-span-2' : ''}">
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide">${f.label}</label>
                        ${input}
                    </div>`;
        }).join('');
        document.getElementById('addModal').classList.remove('hidden');
    }

    function closeAddModal() { document.getElementById('addModal').classList.add('hidden'); }

    async function submitAddData() {
        const data = Object.fromEntries(new FormData(document.getElementById('addForm')).entries());
        try {
            const res = await axios.post(`${API_BASE_URL}/api/admin/${currentTable}`, data, { headers: { 'secret': document.getElementById('adminSecret').value } });
            if(res.data.error) throw new Error(res.data.error);
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            closeAddModal();
            fetchData();
        } catch (e) { Swal.fire('Error', e.message, 'error'); }
    }

    async function deleteData(id) {
        if((await Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?', text: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ", icon: 'warning', showCancelButton: true, confirmButtonColor: '#e11d48', cancelButtonColor: '#64748b' })).isConfirmed) {
            await axios.delete(`${API_BASE_URL}/api/admin/${currentTable}/${id}`, { headers: { 'secret': document.getElementById('adminSecret').value } });
            fetchData();
        }
    }

    switchTab('training_courses');
</script>
</body>
</html>
