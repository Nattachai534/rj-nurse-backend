<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <style> 
        body { font-family: 'Sarabun', sans-serif; } 
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f1f1; }
        textarea::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Loading Overlay */
        .loading-overlay {
            position: absolute; inset: 0; background: rgba(255,255,255,0.7);
            display: flex; justify-content: center; align-items: center; z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <nav class="bg-gradient-to-r from-rose-600 to-pink-600 text-white p-4 shadow-lg sticky top-0 z-40">
        <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center gap-3">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <span class="bg-white text-rose-600 p-1 rounded-full"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg></span>
                Admin V3.8 (‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£)
            </h1>
            <div class="flex gap-2 items-center bg-white/10 p-1.5 rounded-lg">
                <input type="password" id="adminSecret" placeholder="‡∏£‡∏´‡∏±‡∏™ Admin..." class="px-3 py-1.5 text-gray-800 rounded text-sm w-32 border-none focus:ring-2 focus:ring-white/50 shadow-inner bg-white">
                <button type="button" id="btnReload" onclick="fetchData()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-1.5 rounded text-sm transition font-bold shadow-md active:transform active:scale-95 flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 sm:p-6">
        <!-- Tabs -->
        <div class="flex gap-2 mb-6 border-b-2 border-gray-200 pb-1 overflow-x-auto select-none">
            <button type="button" onclick="switchTab('training_courses')" class="tab-btn px-5 py-2.5 rounded-t-lg font-semibold transition-all duration-200 whitespace-nowrap" id="tab-training">üéì ‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</button>
            <button type="button" onclick="switchTab('meeting_schedule')" class="tab-btn px-5 py-2.5 rounded-t-lg font-semibold transition-all duration-200 whitespace-nowrap" id="tab-meeting">üìù ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</button>
            <button type="button" onclick="switchTab('nursing_projects')" class="tab-btn px-5 py-2.5 rounded-t-lg font-semibold transition-all duration-200 whitespace-nowrap" id="tab-project">üöÄ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</button>
            <button type="button" onclick="switchTab('nursing_units')" class="tab-btn px-5 py-2.5 rounded-t-lg font-semibold transition-all duration-200 whitespace-nowrap" id="tab-units">üè• ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</button>
        </div>

        <!-- Toolbar -->
        <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
            <h2 id="current-table-title" class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                <span class="w-2 h-8 bg-rose-500 rounded-full inline-block"></span>
                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </h2>
            <button type="button" onclick="openAddModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg shadow-lg flex items-center gap-2 transition transform active:scale-95 w-full sm:w-auto justify-center font-medium">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> 
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200 relative min-h-[300px]">
            <div id="loadingSpinner" class="loading-overlay hidden">
                <div class="animate-spin w-10 h-10 border-4 border-rose-500 rounded-full border-t-transparent"></div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-600">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-100 border-b">
                        <tr id="table-header"></tr>
                    </thead>
                    <tbody id="table-body" class="divide-y divide-gray-100">
                        <tr><td colspan="10" class="p-10 text-center text-gray-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ Admin ‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Form -->
    <div id="addModal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center z-50 backdrop-blur-sm p-4 transition-opacity">
        <div class="bg-white rounded-2xl p-6 w-full max-w-3xl shadow-2xl transform transition-all scale-100 max-h-[90vh] overflow-y-auto border border-gray-100">
            <div class="flex justify-between items-center mb-5 border-b pb-3">
                <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                    <span class="bg-rose-100 text-rose-600 p-1.5 rounded-lg"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></span>
                    <span id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                </h3>
                <button type="button" onclick="closeAddModal()" class="text-gray-400 hover:text-red-500 transition text-2xl font-bold">&times;</button>
            </div>
            
            <form id="addForm" class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4" onsubmit="event.preventDefault();"></form>
            
            <div class="mt-8 flex justify-end gap-3 border-t pt-4">
                <button type="button" onclick="closeAddModal()" class="px-5 py-2.5 text-gray-600 hover:bg-gray-100 rounded-lg font-medium transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button type="button" onclick="submitData()" id="btnSave" class="px-6 py-2.5 bg-rose-600 text-white rounded-lg hover:bg-rose-700 shadow-md font-bold transition flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>
    </div>

<script>
    // ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç URL ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Render ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ / ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢)
    const API_BASE_URL = "https://rj-nurse-backend.onrender.com"; 
    
    let currentTable = localStorage.getItem("last_tab") || "training_courses"; // ‡∏à‡∏≥‡πÅ‡∏ó‡πá‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    let editingId = null;

    document.addEventListener("DOMContentLoaded", () => {
        const savedSecret = localStorage.getItem("admin_secret");
        if(savedSecret) document.getElementById('adminSecret').value = savedSecret;
        
        // ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ó‡πá‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        switchTab(currentTable, false); 
        
        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™ ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏¢
        if(savedSecret) fetchData();
    });

    const TABLE_CONFIG = {
        "training_courses": {
            title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏≠‡∏ö‡∏£‡∏°",
            headers: ["‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà", "‡∏•‡∏¥‡∏á‡∏Å‡πå", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"],
            fields: [
                {name: "course_name", label: "‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£", type: "text", col: "span-2"},
                {name: "description", label: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î/‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤", type: "textarea", col: "span-2"},
                {name: "date_start", label: "‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°", type: "date"},
                {name: "date_end", label: "‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î", type: "date"},
                {name: "location", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î", type: "text", col: "span-2"},
                {name: "link_register", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (Google Form)", type: "text"},
                {name: "link_zoom", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå Zoom/Online", type: "text"},
                {name: "responsible_unit", label: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö", type: "text"},
                {name: "unit_phone", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "contact_person", label: "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                {name: "contact_phone", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                {name: "process_status", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", type: "select", options: ["‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£", "‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£", "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"]}
            ]
        },
        "meeting_schedule": {
            title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°",
            headers: ["‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤", "‡∏´‡πâ‡∏≠‡∏á/‡∏•‡∏¥‡∏á‡∏Å‡πå", "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"],
            fields: [
                {name: "title", label: "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°", type: "text", col: "span-2"},
                {name: "agenda", label: "‡∏ß‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°", type: "textarea", col: "span-2"},
                {name: "meeting_date", label: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", type: "date", col: "span-2"},
                {name: "start_time", label: "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°", type: "time"},
                {name: "end_time", label: "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡∏¥‡∏Å", type: "time"},
                {name: "room", label: "‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°", type: "text"},
                {name: "link_zoom", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå Zoom", type: "text"},
                {name: "link_register", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô", type: "text"},
                {name: "responsible_unit", label: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "contact_person", label: "‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                {name: "process_status", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", type: "select", options: ["‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢", "‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô", "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"]}
            ]
        },
        "nursing_projects": {
            title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£",
            headers: ["‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", "‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", "‡∏•‡∏¥‡∏á‡∏Å‡πå", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"],
            fields: [
                {name: "project_name", label: "‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", type: "text", col: "span-2"},
                {name: "objective", label: "‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå", type: "textarea", col: "span-2"},
                {name: "fiscal_year", label: "‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", type: "number", value: 2568},
                {name: "responsible_unit", label: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", type: "text"},
                {name: "contact_person", label: "‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", type: "text"},
                {name: "link_register", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", type: "text"},
                {name: "link_zoom", label: "‡∏•‡∏¥‡∏á‡∏Å‡πå Zoom", type: "text"},
                {name: "process_status", label: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", type: "select", options: ["‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô", "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"]}
            ]
        },
        "nursing_units": {
            title: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£",
            headers: ["‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", "‡∏ä‡∏±‡πâ‡∏ô/‡∏ï‡∏∂‡∏Å", "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£", "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"],
            fields: [
                {name: "unit_name", label: "‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/Ward", type: "text", col: "span-2"},
                {name: "floor", label: "‡∏ä‡∏±‡πâ‡∏ô/‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£", type: "text"},
                {name: "phone_number", label: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå", type: "text"},
                {name: "description", label: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°", type: "textarea", col: "span-2"}
            ]
        }
    };

    function switchTab(table, loadData = true) {
        currentTable = table;
        localStorage.setItem("last_tab", table); // ‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡πÑ‡∏ß‡πâ

        document.querySelectorAll('.tab-btn').forEach(b => {
            b.classList.remove('bg-rose-500', 'text-white', 'shadow-md');
            b.classList.add('bg-white', 'text-gray-600', 'hover:bg-gray-50');
        });
        
        let btnId = 'tab-training';
        if(table === 'meeting_schedule') btnId = 'tab-meeting';
        else if(table === 'nursing_projects') btnId = 'tab-project';
        else if(table === 'nursing_units') btnId = 'tab-units';

        const activeBtn = document.getElementById(btnId);
        activeBtn.classList.remove('bg-white', 'text-gray-600', 'hover:bg-gray-50');
        activeBtn.classList.add('bg-rose-500', 'text-white', 'shadow-md');
        
        document.getElementById('current-table-title').innerHTML = `<span class="w-2 h-8 bg-rose-500 rounded-full inline-block"></span> ${TABLE_CONFIG[table].title}`;
        renderTableHeader();
        if(loadData) fetchData();
    }

    function renderTableHeader() {
        const thead = document.getElementById('table-header');
        thead.innerHTML = TABLE_CONFIG[currentTable].headers.map(h => `<th class="px-6 py-3 whitespace-nowrap border-b font-bold tracking-wider">${h}</th>`).join('') + `<th class="px-6 py-3 border-b text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>`;
    }

    async function fetchData() {
        const secret = document.getElementById('adminSecret').value;
        if(!secret) return; 
        
        localStorage.setItem("admin_secret", secret);
        
        // Show Loading
        document.getElementById('loadingSpinner').classList.remove('hidden');
        document.getElementById('btnReload').disabled = true;
        document.getElementById('btnReload').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...";

        try {
            const res = await axios.get(`${API_BASE_URL}/api/admin/${currentTable}`, { headers: { 'secret': secret } });
            
            if(res.data.error) throw new Error(res.data.error);
            
            const tbody = document.getElementById('table-body');
            if(res.data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="10" class="p-10 text-center text-gray-400 flex flex-col items-center gap-2"><svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path></svg>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ</td></tr>`;
            } else {
                tbody.innerHTML = res.data.map(row => {
                    let cols = '';
                    // Logic ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                    if(currentTable === 'nursing_units') {
                        cols = `<td class="px-6 py-4 font-bold text-gray-800">${row.unit_name}</td>
                                <td class="px-6 py-4">${row.floor||'-'}</td>
                                <td class="px-6 py-4 text-blue-600 font-medium">${row.phone_number||'-'}</td>
                                <td class="px-6 py-4 text-gray-500 text-sm max-w-xs truncate">${row.description||''}</td>`;
                    } else {
                        let contact = `<div class="text-sm font-semibold">${row.responsible_unit||'-'}</div>
                                       <div class="text-xs text-gray-500">${row.unit_phone||''}</div>
                                       ${row.contact_person ? `<div class="text-xs text-blue-500 mt-1">‡∏Ñ‡∏∏‡∏ì${row.contact_person}</div>` : ''}`;
                        
                        let linksHtml = '';
                        if (row.link_register) linksHtml += `<a href="${row.link_register}" target="_blank" class="text-blue-600 hover:text-blue-800 block text-xs mb-1 flex items-center gap-1">üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a>`;
                        if (row.link_zoom) linksHtml += `<a href="${row.link_zoom}" target="_blank" class="text-green-600 hover:text-green-800 block text-xs flex items-center gap-1">üìπ Zoom</a>`;

                        if(currentTable === 'training_courses') {
                            cols = `<td class="px-6 py-4 font-semibold text-gray-700">${row.course_name}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-xs text-gray-500">${row.date_start}</td>
                                    <td class="px-6 py-4 text-sm">${row.location}</td>
                                    <td class="px-6 py-4">${linksHtml}</td>
                                    <td class="px-6 py-4"><span class="bg-yellow-50 text-yellow-700 border border-yellow-200 px-2 py-1 rounded text-xs whitespace-nowrap">${row.process_status}</span></td>`;
                        } else if(currentTable === 'meeting_schedule') {
                            cols = `<td class="px-6 py-4 font-semibold text-gray-700">${row.title}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-xs text-gray-500">${row.meeting_date}<br>${row.start_time}</td>
                                    <td class="px-6 py-4 text-sm">${row.room}</td>
                                    <td class="px-6 py-4 text-sm">${contact}</td>
                                    <td class="px-6 py-4"><span class="bg-gray-50 text-gray-700 border border-gray-200 px-2 py-1 rounded text-xs whitespace-nowrap">${row.process_status}</span></td>`;
                        } else {
                            cols = `<td class="px-6 py-4 font-semibold text-gray-700">${row.project_name}</td>
                                    <td class="px-6 py-4 text-sm">${row.responsible_unit}</td>
                                    <td class="px-6 py-4 text-sm">‡∏Ñ‡∏∏‡∏ì${row.contact_person||'-'}</td>
                                    <td class="px-6 py-4">${linksHtml}</td>
                                    <td class="px-6 py-4"><span class="bg-blue-50 text-blue-700 border border-blue-200 px-2 py-1 rounded text-xs whitespace-nowrap">${row.process_status}</span></td>`;
                        }
                    }
                    
                    // ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                    const rowData = JSON.stringify(row).replace(/"/g, '&quot;');
                    return `<tr class="bg-white border-b hover:bg-rose-50 transition duration-150">${cols}
                            <td class="px-6 py-4 text-center whitespace-nowrap">
                                <button type="button" onclick='openEditModal(${rowData})' class="bg-blue-50 text-blue-600 hover:bg-blue-100 p-2 rounded-lg transition mr-1" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">‚úèÔ∏è</button>
                                <button type="button" onclick="deleteData(${row.id})" class="bg-red-50 text-red-600 hover:bg-red-100 p-2 rounded-lg transition" title="‡∏•‡∏ö">üóëÔ∏è</button>
                            </td></tr>`;
                }).join('');
            }
        } catch (e) {
            Swal.fire({ title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: e.message, icon: 'error', confirmButtonColor: '#e11d48' });
        } finally {
            document.getElementById('loadingSpinner').classList.add('hidden');
            document.getElementById('btnReload').disabled = false;
            document.getElementById('btnReload').innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•`;
        }
    }

    function openAddModal() {
        editingId = null;
        document.getElementById('modalTitle').innerText = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà";
        renderForm();
        document.getElementById('addModal').classList.remove('hidden');
    }

    function openEditModal(row) {
        editingId = row.id;
        document.getElementById('modalTitle').innerText = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        renderForm(row);
        document.getElementById('addModal').classList.remove('hidden');
    }

    function renderForm(data = {}) {
        const form = document.getElementById('addForm');
        form.innerHTML = TABLE_CONFIG[currentTable].fields.map(f => {
            let val = data[f.name] || '';
            if(f.name === 'fiscal_year' && !val) val = 2568;
            
            let input = '';
            if(f.type === 'select') {
                input = `<select name="${f.name}" class="w-full p-2.5 border border-gray-300 rounded-lg outline-none bg-gray-50 focus:bg-white focus:ring-2 focus:ring-rose-200 transition">
                            ${f.options.map(o => `<option value="${o}" ${val===o?'selected':''}>${o}</option>`).join('')}
                         </select>`;
            } else if (f.type === 'textarea') {
                input = `<textarea name="${f.name}" class="w-full p-2.5 border border-gray-300 rounded-lg outline-none h-24 resize-none bg-gray-50 focus:bg-white focus:ring-2 focus:ring-rose-200 transition">${val}</textarea>`;
            } else {
                input = `<input type="${f.type}" name="${f.name}" value="${val}" class="w-full p-2.5 border border-gray-300 rounded-lg outline-none bg-gray-50 focus:bg-white focus:ring-2 focus:ring-rose-200 transition">`;
            }
            let colClass = f.col ? f.col : 'span-1';
            return `<div class="col-${colClass} ${f.type === 'textarea' ? 'md:col-span-2' : ''}">
                        <label class="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wide">${f.label}</label>
                        ${input}
                    </div>`;
        }).join('');
    }

    function closeAddModal() { document.getElementById('addModal').classList.add('hidden'); }

    async function submitData() {
        const btn = document.getElementById('btnSave');
        const originalText = btn.innerHTML;
        btn.disabled = true; btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

        const data = Object.fromEntries(new FormData(document.getElementById('addForm')).entries());
        const secret = document.getElementById('adminSecret').value;
        
        try {
            let res;
            if (editingId) {
                res = await axios.put(`${API_BASE_URL}/api/admin/${currentTable}/${editingId}`, data, { headers: { 'secret': secret } });
            } else {
                res = await axios.post(`${API_BASE_URL}/api/admin/${currentTable}`, data, { headers: { 'secret': secret } });
            }
            
            if(res.data.error) throw new Error(res.data.error);
            
            // Toast Notification
            const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 3000 });
            Toast.fire({ icon: 'success', title: editingId ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' });
            
            closeAddModal();
            fetchData();
        } catch (e) { 
            Swal.fire({ title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', text: e.message, icon: 'error', confirmButtonColor: '#e11d48' });
        } finally {
            btn.disabled = false; btn.innerHTML = originalText;
        }
    }

    async function deleteData(id) {
        if((await Swal.fire({ 
            title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?', text: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÅ‡∏•‡∏∞‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ", icon: 'warning', 
            showCancelButton: true, confirmButtonColor: '#e11d48', cancelButtonColor: '#64748b',
            confirmButtonText: '‡∏•‡∏ö‡πÄ‡∏•‡∏¢', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' 
        })).isConfirmed) {
            try {
                await axios.delete(`${API_BASE_URL}/api/admin/${currentTable}/${id}`, { headers: { 'secret': document.getElementById('adminSecret').value } });
                
                const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 3000 });
                Toast.fire({ icon: 'success', title: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢' });
                
                fetchData();
            } catch(e) {
                Swal.fire('Error', e.message, 'error');
            }
        }
    }
</script>
</body>
</html>
